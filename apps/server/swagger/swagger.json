{
  "openapi": "3.0.0",
  "info": {
    "version": "1.0.0",
    "title": "Online Library",
    "description": "API for Online Library"
  },
  "servers": [
    {
      "url": "http://localhost:3001/"
    }
  ],
  "paths": {
    "/api/auth-check": {
      "get": {
        "tags": [
          "Root"
        ],
        "summary": "Auth check",
        "description": "   ✅ Checks existance of <b>auth token</b> in cookies and validates it <br />   ✅ Returns proper role to the end user <br />   ",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Returns current role",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/schema@role"
                }
              },
              "application/xml": {
                "schema": {
                  "$ref": "#/components/schemas/schema@role"
                }
              }
            }
          },
          "422": {
            "$ref": "#/components/schemas/422@data-validation",
            "description": "Unprocessable Entity"
          }
        }
      }
    },
    "/api/logout": {
      "get": {
        "tags": [
          "Root"
        ],
        "summary": "Logout",
        "description": "   ✅ Logs user out <br />   ✅ Removes auth token from cookies <br />   ",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Returns current role",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/schema@role"
                }
              },
              "application/xml": {
                "schema": {
                  "$ref": "#/components/schemas/schema@role"
                }
              }
            }
          },
          "422": {
            "$ref": "#/components/schemas/422@data-validation",
            "description": "Unprocessable Entity"
          }
        }
      }
    },
    "/api/user/auth/register": {
      "post": {
        "tags": [
          "Auth (rate limited)"
        ],
        "summary": "Account registration",
        "description": "   ✅ Checks if user already exist <br />   ✅ Generates an <b>activation token</b> <br />   ✅ Sends link with the <b>token</b> to allow user activate his account <br />   ",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Check inbox for an e-mail with the activation link"
          },
          "409": {
            "description": "Email address already taken"
          },
          "422": {
            "$ref": "#/components/schemas/422@data-validation",
            "description": "Unprocessable Entity"
          },
          "429": {
            "$ref": "#/components/schemas/429@rate-limit",
            "description": "Too Many Requests"
          },
          "502": {
            "$ref": "#/components/schemas/502@activation-link",
            "description": "Bad Gateway"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/post@register"
              }
            },
            "application/xml": {
              "schema": {
                "$ref": "#/components/schemas/post@register"
              }
            }
          }
        }
      }
    },
    "/api/user/auth/account": {
      "patch": {
        "tags": [
          "Auth (rate limited)"
        ],
        "summary": "Account activation",
        "description": "   ✅ Check if user already activated his account <br />   ✅ Toggles account as activated if it's not alread <br />   ",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Account has been activated"
          },
          "403": {
            "$ref": "#/components/schemas/503@account-activated",
            "description": "Forbidden"
          },
          "409": {
            "description": "No authentication associated with this link"
          },
          "422": {
            "$ref": "#/components/schemas/422@data-validation",
            "description": "Unprocessable Entity"
          },
          "429": {
            "$ref": "#/components/schemas/429@rate-limit",
            "description": "Too Many Requests"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/patch@account"
              }
            },
            "application/xml": {
              "schema": {
                "$ref": "#/components/schemas/patch@account"
              }
            }
          }
        }
      }
    },
    "/api/user/auth/activation-token": {
      "post": {
        "tags": [
          "Auth (rate limited)"
        ],
        "summary": "Account activation token",
        "description": "   ✅ Ensures user with provided email address exists <br />   ✅ Rejects resending activation token if account is already activate <br />   ✅ Sends new activation token to the use <br />   ",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Link with new activation token has been sent"
          },
          "403": {
            "$ref": "#/components/schemas/503@account-activated",
            "description": "Forbidden"
          },
          "404": {
            "$ref": "#/components/schemas/404@incorrect-email-address",
            "description": "Not Found"
          },
          "422": {
            "$ref": "#/components/schemas/422@data-validation",
            "description": "Unprocessable Entity"
          },
          "429": {
            "$ref": "#/components/schemas/429@rate-limit",
            "description": "Too Many Requests"
          },
          "502": {
            "$ref": "$/definitions/502@activation-link",
            "description": "Bad Gateway"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/post@activation-token"
              }
            },
            "application/xml": {
              "schema": {
                "$ref": "#/components/schemas/post@activation-token"
              }
            }
          }
        }
      }
    },
    "/api/user/auth/login/credentials": {
      "post": {
        "tags": [
          "Auth (rate limited)"
        ],
        "summary": "Authentication",
        "description": "   ✅ Checks given email and password <br />   ✅ Check if account is activated <br />   ✅ Sends auth token, that expires in 24h, if credentials are ok<br />   ",
        "parameters": [],
        "responses": {
          "200": {
            "$ref": "#/components/schemas/200@auth-token",
            "description": "OK"
          },
          "401": {
            "description": "The given credentials are wrong"
          },
          "403": {
            "description": "Account not activated"
          },
          "422": {
            "$ref": "#/components/schemas/422@data-validation",
            "description": "Unprocessable Entity"
          },
          "429": {
            "$ref": "#/components/schemas/429@rate-limit",
            "description": "Too Many Requests"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/post@login-credentials"
              }
            },
            "application/xml": {
              "schema": {
                "$ref": "#/components/schemas/post@login-credentials"
              }
            }
          }
        }
      }
    },
    "/api/user/auth/login/fb": {
      "post": {
        "tags": [
          "Auth (rate limited)"
        ],
        "summary": "Authentication",
        "description": "   ✅ Verifies <b>access token</b> provided by FB auth <br />   ✅ Sends <b>auth token</b>, that expires in 24h, for either already existing user or newly created one <br />   ",
        "parameters": [],
        "responses": {
          "200": {
            "$ref": "#/components/schemas/200@auth-token",
            "description": "OK"
          },
          "400": {
            "description": "FB authentication has failed"
          },
          "422": {
            "$ref": "#/components/schemas/422@data-validation",
            "description": "Unprocessable Entity"
          },
          "429": {
            "$ref": "#/components/schemas/429@rate-limit",
            "description": "Too Many Requests"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/post@login-fb"
              }
            },
            "application/xml": {
              "schema": {
                "$ref": "#/components/schemas/post@login-fb"
              }
            }
          }
        }
      }
    },
    "/api/user/auth/password": {
      "post": {
        "tags": [
          "Auth (rate limited)"
        ],
        "summary": "Password reset request",
        "description": "   ✅ Checks if any user belongs to provided email address <br />   ✅ Makes sure that user account is activated <br />   ✅ Generates <b>password token</b> to authorize changing password in the next step (password form) <br />   ",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Link to reset the password has been sent"
          },
          "404": {
            "$ref": "#/components/schemas/404@incorrect-email-address",
            "description": "Not Found"
          },
          "409": {
            "description": "Account must be firstly activated"
          },
          "422": {
            "$ref": "#/components/schemas/422@data-validation",
            "description": "Unprocessable Entity"
          },
          "429": {
            "$ref": "#/components/schemas/429@rate-limit",
            "description": "Too Many Requests"
          },
          "502": {
            "description": "There was a problem sending the link to reset password"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/post@password"
              }
            },
            "application/xml": {
              "schema": {
                "$ref": "#/components/schemas/post@password"
              }
            }
          }
        }
      },
      "patch": {
        "tags": [
          "Auth (rate limited)"
        ],
        "summary": "Password change",
        "description": "   ✅ Changes user password <br />   ",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Password has been changed"
          },
          "400": {
            "description": "Link to reset the password is invalid"
          },
          "422": {
            "$ref": "#/components/schemas/422@data-validation",
            "description": "Unprocessable Entity"
          },
          "429": {
            "$ref": "#/components/schemas/429@rate-limit",
            "description": "Too Many Requests"
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/patch@password"
              }
            },
            "application/xml": {
              "schema": {
                "$ref": "#/components/schemas/patch@password"
              }
            }
          }
        }
      }
    },
    "/api/user/books": {
      "get": {
        "tags": [
          "Books"
        ],
        "summary": "Books searcher",
        "description": "   ✅ Suggest books by author or title <br />   ✅ Searches either books assigned to the user or from the whole store <br />   ",
        "parameters": [
          {
            "name": "obj",
            "in": "query",
            "required": true,
            "schema": {
              "$ref": "#/components/schemas/get@books"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Returns array of books that meet certain title or author",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/schema@book"
                  },
                  "xml": {
                    "name": "main"
                  }
                }
              },
              "application/xml": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/schema@book"
                  },
                  "xml": {
                    "name": "main"
                  }
                }
              }
            }
          },
          "422": {
            "$ref": "#/components/schemas/422@data-validation",
            "description": "Unprocessable Entity"
          }
        },
        "security": [
          {
            "authToken": []
          }
        ]
      }
    },
    "/api/user/cart/stripe/payment": {
      "post": {
        "tags": [
          "Cart"
        ],
        "summary": "Stripe payment processing",
        "description": "   ✅ Makes sure that user does not pay for already purchased books <br />   ✅ Checks if selected books are still available in the store <br />   ✅ Processes stripe payment with credit card <br />   ✅ Assigns purchased books to the user <br />   ",
        "parameters": [],
        "responses": {
          "200": {
            "$ref": "#/components/schemas/200@purchased-books",
            "description": "OK"
          },
          "402": {
            "$ref": "#/components/schemas/402@payment-failed",
            "description": "Payment Required"
          },
          "404": {
            "$ref": "#/components/schemas/404@books-not-available",
            "description": "Not Found"
          },
          "409": {
            "$ref": "#/components/schemas/409@books-already-purchased",
            "description": "Conflict"
          },
          "422": {
            "$ref": "#/components/schemas/422@data-validation",
            "description": "Unprocessable Entity"
          }
        },
        "security": [
          {
            "authToken": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/post@stripe-payment"
              }
            },
            "application/xml": {
              "schema": {
                "$ref": "#/components/schemas/post@stripe-payment"
              }
            }
          }
        }
      }
    },
    "/api/user/cart/paypal/checkout": {
      "post": {
        "tags": [
          "Cart"
        ],
        "summary": "Paypal checkout",
        "description": "   ✅ Makes sure that user does not pay for already purchased books <br />   ✅ Checks if selected books are still available in the store <br />   ✅ Prepares paypal payment details <br />   ✅ Redirects user to paypal checkout <br />   ",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Returns paypal checkout link",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/schema@paypal-link"
                }
              },
              "application/xml": {
                "schema": {
                  "$ref": "#/components/schemas/schema@paypal-link"
                }
              }
            }
          },
          "402": {
            "description": "There was a problem preparing the payment, try again"
          },
          "404": {
            "$ref": "#/components/schemas/404@books-not-available",
            "description": "Not Found"
          },
          "409": {
            "$ref": "#/components/schemas/409@books-already-purchased",
            "description": "Conflict"
          },
          "422": {
            "$ref": "#/components/schemas/422@data-validation",
            "description": "Unprocessable Entity"
          }
        },
        "security": [
          {
            "authToken": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/post@paypal-checkout"
              }
            },
            "application/xml": {
              "schema": {
                "$ref": "#/components/schemas/post@paypal-checkout"
              }
            }
          }
        }
      }
    },
    "/api/user/cart/paypal/payment": {
      "post": {
        "tags": [
          "Cart"
        ],
        "summary": "Paypal payment processing",
        "description": "   ✅ Checks if user booked paymeny with certain id <br />   ✅ Checks if payment is still in progress <br />   ✅ Finalizes paypal payment and updates its status <br />   ✅ Assigns purchased books to the user <br />   ",
        "parameters": [],
        "responses": {
          "200": {
            "$ref": "#/components/schemas/200@purchased-books",
            "description": "OK"
          },
          "402": {
            "$ref": "#/components/schemas/402@payment-failed",
            "description": "Payment Required"
          },
          "404": {
            "description": "Bad payment id"
          },
          "409": {
            "description": "The order has been already approved"
          },
          "422": {
            "$ref": "#/components/schemas/422@data-validation",
            "description": "Unprocessable Entity"
          }
        },
        "security": [
          {
            "authToken": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/post@paypal-payment"
              }
            },
            "application/xml": {
              "schema": {
                "$ref": "#/components/schemas/post@paypal-payment"
              }
            }
          }
        }
      }
    },
    "/api/user/chat/messages": {
      "get": {
        "tags": [
          "Chat"
        ],
        "summary": "Chat messages",
        "description": "   ✅ Returns some of the previous messages (implements infinite scroll) <br />   ✅ Mark messages as read by user that requested this endpoint <br />   ",
        "parameters": [
          {
            "name": "obj",
            "in": "query",
            "required": true,
            "schema": {
              "$ref": "#/components/schemas/get@messages"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Return array of messages",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/schema@message"
                  },
                  "xml": {
                    "name": "main"
                  }
                }
              },
              "application/xml": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/schema@message"
                  },
                  "xml": {
                    "name": "main"
                  }
                }
              }
            }
          },
          "422": {
            "$ref": "#/components/schemas/422@data-validation",
            "description": "Unprocessable Entity"
          }
        },
        "security": [
          {
            "authToken": []
          }
        ]
      },
      "post": {
        "tags": [
          "Chat"
        ],
        "summary": "Sending message",
        "description": "   ✅ Sends text message to others <br />   ✅ Sends push notification <br />   ",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Message has been sent"
          },
          "422": {
            "$ref": "#/components/schemas/422@data-validation",
            "description": "Unprocessable Entity"
          }
        },
        "security": [
          {
            "authToken": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/post@messages"
              }
            },
            "application/xml": {
              "schema": {
                "$ref": "#/components/schemas/post@messages"
              }
            }
          }
        }
      }
    },
    "/api/user/chat/files": {
      "post": {
        "tags": [
          "Chat"
        ],
        "summary": "Sending file",
        "description": "   ✅ If file is an image it reduces its size <br />   ✅ Validates size & extension of the file <br />   ✅ Uploads file to cloudinary <br />   ✅ Sends file / image / video to others <br />   ✅ Sends proper push notification <br />   ",
        "parameters": [],
        "responses": {
          "200": {
            "description": "File has been sent",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/schema@file"
                }
              },
              "application/xml": {
                "schema": {
                  "$ref": "#/components/schemas/schema@file"
                }
              }
            }
          },
          "413": {
            "description": "File size too large"
          },
          "415": {
            "description": "Such file is not supported"
          },
          "422": {
            "description": "File has not been attached"
          }
        },
        "security": [
          {
            "authToken": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "$ref": "#/components/schemas/post@files"
          }
        }
      }
    },
    "/api/user/chat/notifications": {
      "post": {
        "tags": [
          "Chat"
        ],
        "summary": "Push notifications",
        "description": "   ✅ Stores web push subscription detail in the database <br />   ✅ Creates many subscriptions per user (user can use multiple devices) <br />   ",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Subscription has been saved"
          },
          "422": {
            "$ref": "#/components/schemas/422@data-validation",
            "description": "Unprocessable Entity"
          }
        },
        "security": [
          {
            "authToken": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/post@notifications"
              }
            },
            "application/xml": {
              "schema": {
                "$ref": "#/components/schemas/post@notifications"
              }
            }
          }
        }
      }
    },
    "/api/user/chat/details": {
      "get": {
        "tags": [
          "Chat"
        ],
        "summary": "Chat details",
        "description": "   ✅ Returns info related to chatting <br />   ✅ Counts how many messages user missed since last view <br />   ✅ Returns index of last undread message so user can easily scroll to it <br />   ",
        "parameters": [],
        "responses": {
          "200": {
            "description": "Details returned",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/schema@chat-details"
                }
              },
              "application/xml": {
                "schema": {
                  "$ref": "#/components/schemas/schema@chat-details"
                }
              }
            }
          },
          "422": {
            "$ref": "#/components/schemas/422@data-validation",
            "description": "Unprocessable Entity"
          }
        },
        "security": [
          {
            "authToken": []
          }
        ]
      }
    }
  },
  "components": {
    "schemas": {
      "schema@role": {
        "type": "object",
        "properties": {
          "role": {
            "type": "string",
            "enum": [
              "guest",
              "user"
            ]
          }
        }
      },
      "schema@book": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          },
          "title": {
            "type": "string",
            "example": "Hound Dog"
          },
          "author": {
            "type": "string",
            "example": "Nina Barton"
          },
          "cover": {
            "type": "string",
            "format": "uri",
            "qt-uri-protocols": [
              "https"
            ],
            "example": "https://loremflickr.com/640/480/nature?78445"
          },
          "price": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "description": "Price in $",
            "example": 14
          }
        }
      },
      "schema@chat-details": {
        "type": "object",
        "properties": {
          "lastUnreadMessageIndex": {
            "type": "integer",
            "required": true,
            "description": "Index of last unread message"
          },
          "unreadMessagesAmount": {
            "type": "integer",
            "required": true,
            "description": "Amount of missed messages"
          },
          "userId": {
            "type": "integer",
            "required": true,
            "description": "Id of logged in user"
          }
        }
      },
      "schema@file": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "MESSAGE",
              "IMAGE",
              "VIDEO",
              "FILE"
            ]
          },
          "content": {
            "type": "string",
            "format": "uri",
            "qt-uri-protocols": [
              "https"
            ],
            "qt-uri-extensions": [
              "jpg",
              "jpeg",
              "png",
              "mp4",
              "txt",
              "rtf",
              "doc",
              "docx",
              "xlsx",
              "ppt",
              "pptx",
              "pdf"
            ],
            "description": "Link to uploaded resource",
            "example": "https://res.cloudinary.com/onlinelibrary-storage/raw/upload/v1662546764/111296ee27d2a82152225969d92eb660a16d16b041d3712e0ee860ae01ed78a8e01bc77f4b888fb0681cebba0ec619bb10012b3a3cfee8c_fbhuen.txt"
          }
        }
      },
      "schema@message": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          },
          "type": {
            "type": "string",
            "enum": [
              "MESSAGE",
              "IMAGE",
              "VIDEO",
              "FILE"
            ]
          },
          "content": {
            "type": "string",
            "format": "uri",
            "qt-uri-protocols": [
              "https"
            ],
            "qt-uri-extensions": [
              "jpg",
              "jpeg",
              "png",
              "mp4",
              "txt",
              "rtf",
              "doc",
              "docx",
              "xlsx",
              "ppt",
              "pptx",
              "pdf"
            ],
            "description": "Link to uploaded resource",
            "example": "https://res.cloudinary.com/onlinelibrary-storage/raw/upload/v1662546764/111296ee27d2a82152225969d92eb660a16d16b041d3712e0ee860ae01ed78a8e01bc77f4b888fb0681cebba0ec619bb10012b3a3cfee8c_fbhuen.txt"
          },
          "filename": {
            "type": "string",
            "description": "Name of uploaded file",
            "example": "text.txt"
          },
          "readBy": {
            "type": "string",
            "description": "String as joined array of user ids that read certain message",
            "example": "1,51,62,6,23"
          },
          "cloudinaryId": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ],
            "description": "Id of resource kept at cloudinary",
            "example": "1c644911e2118030c4884278c6835ccd79e0062959dcaa15af09861ae82c2e7bb73b4d53cf7a865255f1d01d2c15653748986ec09ccfb61b0e0163ce_o8qd1l"
          },
          "userId": {
            "type": "integer"
          },
          "user": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              }
            }
          }
        }
      },
      "schema@paypal-link": {
        "type": "string",
        "required": true,
        "description": "Link to paypal checkout generated with /paypalCheckout",
        "example": "https://www.sandbox.paypal.com/cgi-bin/webscr?cmd=_express-checkout&token=EC-27H754218P7505C"
      },
      "post@register": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "required": true,
            "example": "John"
          },
          "email": {
            "type": "string",
            "format": "email",
            "required": true,
            "example": "john@onlinelibrary.com"
          },
          "password": {
            "type": "string",
            "required": true,
            "example": "2hIq8^spf2"
          },
          "repeatedPassword": {
            "type": "string",
            "required": true,
            "example": "2hIq8^spf2"
          }
        }
      },
      "patch@account": {
        "type": "object",
        "properties": {
          "activationToken": {
            "type": "string",
            "required": true,
            "description": "jwt token",
            "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"
          }
        }
      },
      "post@activation-token": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "format": "email",
            "required": true,
            "example": "john@onlinelibrary.com"
          }
        }
      },
      "post@login-credentials": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "format": "email",
            "required": true,
            "example": "john@onlinelibrary.com"
          },
          "password": {
            "type": "string",
            "required": true,
            "example": "2hIq8^spf2"
          }
        }
      },
      "post@login-fb": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "required": true,
            "example": "John"
          },
          "email": {
            "type": "string",
            "format": "email",
            "required": true,
            "example": "john@onlinelibrary.com"
          },
          "access_token": {
            "type": "string",
            "required": true,
            "description": "Access token generated with FB auth",
            "example": "EAAG6VehVAPMBAK30w7QenD65zUARr9d4P3yQf44X5anasd6QnjtEtXH2c7TG234fsBMchb4Pe"
          }
        }
      },
      "post@password": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "format": "email",
            "required": true,
            "example": "john@onlinelibrary.com"
          }
        }
      },
      "patch@password": {
        "type": "object",
        "properties": {
          "password": {
            "type": "string",
            "required": true,
            "example": "2hIq8^spf2"
          },
          "passwordToken": {
            "type": "string",
            "required": true,
            "description": "jwt token",
            "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"
          }
        }
      },
      "post@stripe-payment": {
        "type": "object",
        "properties": {
          "paymentId": {
            "type": "string",
            "required": true,
            "description": "Payment method id, created with stripejs package on the client side",
            "example": "pm_1LeJuTCA0Hw88eOYpY9kEDWK"
          },
          "products": {
            "type": "array",
            "items": {
              "type": "integer"
            },
            "required": true,
            "description": "Array of book ids to purchase",
            "example": [
              1,
              5,
              9,
              11
            ]
          }
        }
      },
      "post@paypal-checkout": {
        "type": "object",
        "properties": {
          "products": {
            "type": "array",
            "items": {
              "type": "integer"
            },
            "required": true,
            "description": "Array of book ids to purchase",
            "example": [
              1,
              5,
              9,
              11
            ]
          }
        }
      },
      "post@paypal-payment": {
        "type": "object",
        "properties": {
          "paymentId": {
            "type": "string",
            "required": true,
            "description": "Payment id generated after submitting paypal checkout",
            "example": "PAYID-MMKLWRQ82689537V0194325L"
          },
          "PayerID": {
            "type": "string",
            "required": true,
            "description": "Payer id generated after submitting paypal checkout",
            "example": "KVYVDZAMZGRRA"
          }
        }
      },
      "post@notifications": {
        "type": "object",
        "properties": {
          "endpoint": {
            "type": "string",
            "format": "uri",
            "qt-uri-protocols": [
              "https"
            ],
            "description": "Subscription details (check out https://www.npmjs.com/package/web-push)",
            "example": "https://fcm.googleapis.com/fcm/send/d61c5u920dw:APA91bEmnw8utjDYCqSRplFMVCzQMg9e5XxpYajvh37mv2QIlISdasBFLbFca9ZZ4Uqcya0ck-SP84YJUEnWsVr3mwYfaDB7vGtsDQuEpfDdcIqOX_wrCRkBW2NDWRZ9qUz9hSgtI3sY"
          },
          "expirationTime": {
            "anyOf": [
              {
                "type": "integer"
              },
              {
                "type": "null"
              }
            ]
          },
          "keys": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "p256dh": {
                "type": "string",
                "required": true,
                "example": "BL7ELU24fJTAlH5Kyl8N6BDCac8u8li_U5PIwG963MOvdYs9s7LSzj8x_7v7RFdLZ9Eap50PiiyF5K0TDAis7t0"
              },
              "auth": {
                "type": "string",
                "required": true,
                "example": "juarI8x__VnHvsOgfeAPHg"
              }
            }
          }
        }
      },
      "get@books": {
        "type": "object",
        "properties": {
          "title": {
            "anyOf": [
              {
                "type": "string",
                "required": true,
                "description": "Title to search for. It takes precedence over the author",
                "example": "Let it Be"
              },
              {
                "type": "string",
                "maxLength": 0,
                "required": true
              }
            ]
          },
          "author": {
            "anyOf": [
              {
                "type": "string",
                "required": true,
                "description": "Author to search for",
                "example": "Craig Nicolas"
              },
              {
                "type": "string",
                "maxLength": 0,
                "required": true
              }
            ]
          },
          "withProfile": {
            "type": "boolean",
            "required": true,
            "description": "If true, it searches books assigned to the user. Otherwise searches in the whole store"
          }
        }
      },
      "get@messages": {
        "type": "object",
        "properties": {
          "limit": {
            "type": "integer",
            "required": true,
            "example": 20
          },
          "offset": {
            "type": "integer",
            "required": true,
            "example": 0
          }
        }
      },
      "post@messages": {
        "type": "object",
        "properties": {
          "content": {
            "type": "string",
            "required": true,
            "description": "Message to others"
          }
        }
      },
      "post@files": {
        "multipart/form-data": {
          "schema": {
            "type": "object",
            "properties": {
              "file": {
                "type": "string",
                "format": "binary",
                "required": true
              }
            }
          }
        }
      },
      "422@data-validation": {
        "description": "Data validation failed"
      },
      "429@rate-limit": {
        "description": "Too many requests"
      },
      "502@activation-link": {
        "description": "There was a problem sending the activation link"
      },
      "503@account-activated": {
        "description": "Account already activated"
      },
      "200@auth-token": {
        "description": "Auth token was set in cookies"
      },
      "404@incorrect-email-address": {
        "description": "Provided email address is incorrect"
      },
      "200@purchased-books": {
        "description": "Successfully purchased new books"
      },
      "404@books-not-available": {
        "description": "Selected books are not available anymore"
      },
      "409@books-already-purchased": {
        "description": "Selected books has been already purchased before"
      },
      "402@payment-failed": {
        "description": "Payment has failed"
      }
    },
    "securitySchemes": {
      "authToken": {
        "in": "cookie",
        "name": "authToken",
        "type": "apiKey",
        "description": "Auth token (jwt) generated with /login or /login/fb"
      }
    }
  }
}